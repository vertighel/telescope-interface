
<style>

.line {
  
    fill: none;
    stroke: springgreen;
    stroke-width: 2px;
 }

.area {
  fill: rgba(255,255,255,.1);
}

 
 .plot_container {
     /* display: inline-block;
	position: relative;
	width: 100%;
	padding-bottom: 100%;
	vertical-align: top;
	overflow: hidden; */
     flex: 1 1 auto;
     display : flex;
     flex-direction: column; 
 }
 .plot_container > svg {
     /* display: inline-block;
	position: absolute;
	top: 0;
	left: 0; */
     flex: 1 1 auto;
     z-index: 2; 
 }

 .wi{
     font-size:0.7em;
     color: springgreen;
     flex: 1 1 auto;
 }
  .ccd_temp{
      font-size:0.7em;
      color: tomato;
      margin-right: 1rem;
  }
 
 .cooling_power{
     font-size:0.7em;
     color: tomato;
 }

 .temp_monitor{
     max-width: 80vh;
     flex: 1 1 auto;
     display: flex;
     flex-direction: column;
     padding: .5rem;
 }
 .temp_info{
     flex: 1 1 auto;
     display: flex;
     justify-content: flex-end; 
 }
 
</style>

<div class="temp_monitor">
    <span class="wi" data-var="wi"></span>
    <div class="temp_info">
	<span class="ccd_temp" data-var="ccd_temp">CCDTemp</span>
	<span class="cooling_power" data-var="cooling_power">CoolPower</span>
    </div>
    <div class="plot_container" data-var="cnt">
	<svg data-var="svg"></svg>
    </div>
</div>

<script class="builder">
 var widget_info = { id : "none"};
 
 var vc=this,x,y,xAxis,yAxis,line,area,xa,ya,garea,gline;
 vc.temp_mon_id=0;
 vc.data=[];
 
 

/// test function to create points
vc.test=function(){
     var numbers = Array.from({length: 64}, () => 0 );
     
     vc.data = numbers.map(function(d,i){
         return {
             x : Math.floor(i/(64/4)), // 4 lines
             y : i,
//            y : i%16,  // 16 columns
             z : d
         }
     });
     //console.log("Data " + JSON.stringify(newdatum));

//     update(newdatum);
 };

 vc.build=function(){
     
     var svg = d3.select(vc.svg);

     vc.svg.innerHTML="";


     var bbox=vc.svg.getBoundingClientRect(); //svg.getBBox();
     
     var	 margin = {top: 10, right: 10, bottom: 20, left: 30},
	 width = +bbox.width - margin.left - margin.right,
	 height = +bbox.height - margin.top - margin.bottom,
	 g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
     
     x = d3.scaleLinear()
	   .range([0,width])
           .domain([0, 1]); /// Just to draw
     
     y = d3.scaleLinear()
	   .range([height, 0])
           .domain([0, 1]); /// Just to draw
     
     xAxis = d3.axisBottom(x).ticks(10).tickFormat(d3.format("d"));
     yAxis = d3.axisLeft(y).ticks(4).tickFormat(d3.format("d"));
     
     /// Define the line
     line = d3.line()
		  .x(function(d,i) { return x(d.y); })
		  .y(function(d,i) { return y(d.z); });
     
     /// Define the area
     area = d3.area()
		  .x0(width) /// Fill from bottom
		  .x1(function(d,i) { return x(d.y); })
		  .y(function(d) { return y(d.z); });
     
     /// Drawing the area
     garea=g.append("g")
      .datum(vc.data)
      .append("path")
      .attr("class", "area")
      .attr("d", area);
     
     /// Drawing the line
     gline=g.append("g") 
      .datum(vc.data)
      .append("path")
      .attr("class", "line")
      .attr("d", line);
     
     /// Drawing the axes
     xa=g.append("g")
	 .call(xAxis)
     //     .attr("class", "axis axis--x")
	 .attr("transform", "translate(0," + (y(0)) + ")")
	 
	 //.selectAll("text")
	 //.style("text-anchor", "end")
	 //.attr("dx", "-.8em")
	 //.attr("dy", ".15em")
	 //.attr("transform", "rotate(-90)");
	 
     
     ya=g.append("g")
     //.attr("class", "axis axis--y")
     //.attr("transform", "translate("+x(0) + ",0)")
      .call(yAxis);
 }

 vc.update_temp=function(cool_info){

     var temp=cool_info.ccd_temp;
     
     if(vc.temp_mon_id>=64) vc.temp_mon_id=0;
     vc.ccd_temp.innerHTML="CCD Temp: "+Math.floor(temp*100)/100.0+"C ";
     vc.cooling_power.innerHTML="Power: "+Math.floor(cool_info.cooling_power*10000)/100.0+"%";
     vc.data[vc.temp_mon_id].z=temp;
     update();
     vc.temp_mon_id++;
 }
 
 /// Updating data, line and axes
 function update(){
     vc.wi.innerHTML=new Date();
     vc.build();
     //     vc.data=newdatum;
     var data=vc.data;
     
     x.domain(d3.extent(data, function(d){return d.y;}));
     y.domain(d3.extent(data, function(d){return d.z;}));
     
     /// Update axis, line, and area
     xa.call(xAxis)
       //.selectAll("text")
       //.style("text-anchor", "end")
       //.attr("dx", "-.8em")
       //.attr("dy", ".15em")
       //.attr("transform", "rotate(-90)");
     
     ya.call(yAxis);
     
     
     //d3.select(line)
     gline
	 .datum(data)
	 .attr("d", line);
     
     //d3.select(area)
     garea
	 .datum(data)
	 .attr("d", area);
     
}
 vc.test();
     

// vc.build();
 vc.build();
 
 /* setInterval(function(){
  *     vc.build();
  * }, 10000);*/
</script>
