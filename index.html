
<!doctype html>
<title>Telescope interface</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- bootstrap.css, jquery, popper, bootstrap.js -->
<link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
<script src="./node_modules/jquery/dist/jquery.min.js"></script>
<script src="./node_modules/popper.js/dist/umd/popper.min.js"></script>
<script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- Widget Engine -->
<script src="./node_modules/widget_engine/lib/js/xhr.js"></script>
<script src="./node_modules/widget_engine/lib/js/widget_engine.js"></script>

<!-- d3 -->
<script src="./node_modules/d3/dist/d3.min.js"></script>

<!-- this -->
<style>
  /* Generated using sass --watch style.scss:style.css */
  /* @import url("./style.css"); */

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.2px;
}

</style>

<body>

<section class="row">

  <form class="col-4">

    <div class="">
      <h4>Camera</h4>
      <x-widget data-class="camera-ccd"></x-widget>
    </div>
    <div class="">
      <h4>Object</h4>
      <x-widget data-class="camera-object"></x-widget>
    </div>

    <div class="">
      <h4>Control</h4>
      <x-widget data-class="camera-controls"></x-widget>
    </div>

  </form>

  <div class="col-4">
    <h4>Table test</h4>
    <x-widget data-class="table"></x-widget>
  </div>

  <div class="col-4">
    <h4>Mini-graph</h4>

    <!-- <button id="createNewPoint">point</button> -->

    <svg width="170" height="100"></svg>

    <script>

var n = 6;
var data = [];
var delay = 500;

// $("#createNewPoint").on("click",function(){
//     var point = {x:new Date(), y:Math.random()} ;
// //    tick();
// });

function tick() {

  // Push a new data point onto the back.
    //data.push(Math.random());
    data.push({x:new Date(), y:Math.random()})

  // Redraw the line.
  d3.select(this)
      .attr("d", line)
      .attr("transform", null);

  // Slide it to the left.
  d3.active(this)
      .attr("transform", "translate(" + x(-1) + ",0)")
    .transition()
        .on("start", tick);

    if (data.length > n) {
        // Pop the old data point off the front.
        data.shift();
    }

//    console.log(data)

}

var svg = d3.select("svg"),
    margin = {top: 2, right: 2, bottom: 2, left: 4},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom,
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var x = d3.scaleLinear()
    .domain([0, n - 1])
    .range([0, width]);

var y = d3.scaleLinear()
    .domain([-1, 1])
    .range([height, 0]);

var line = d3.line()
    .x(function(d, i) { return x(i); })
    .y(function(d, i) { return y(d.y); });

g.append("defs").append("clipPath")
    .attr("id", "clip")
  .append("rect")
    .attr("width", width)
    .attr("height", height);

g.append("g")
    .attr("class", "axis axis--x")
    .attr("transform", "translate(0," + y(0) + ")")
    .call(d3.axisBottom(x).tickValues(0));

g.append("g")
    .attr("class", "axis axis--y")
    .call(d3.axisLeft(y).tickValues(0));

g.append("g")
    .attr("clip-path", "url(#clip)")
  .append("path")
    .datum(data)
    .attr("class", "line")
    .transition()
    .duration(delay)
    .ease(d3.easeLinear)
    .on("start", tick);

</script>

  </div>

</section>

<script>

      $("form").on("submit", function(e){
          e.preventDefault();
          var formData = $(this).serializeArray();
          // var button = $('button[clicked="true"]')
          // formData.push({ name: button.prop("name"), value: button.prop("value") })
          // console.log(button)
          console.log(formData)

      });

</script>
